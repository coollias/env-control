# é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯ - é¡¹ç›®æ€»ç»“

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

æœ¬é¡¹ç›®æ˜¯å¾®æœåŠ¡é…ç½®ç®¡ç†å¹³å°çš„æœåŠ¡ç«¯ï¼ŒåŸºäºSpring Boot 2.7.18å¼€å‘ï¼Œæä¾›äº†å®Œæ•´çš„é…ç½®ç®¡ç†åŠŸèƒ½ï¼ŒåŒ…æ‹¬åº”ç”¨ç®¡ç†ã€ç¯å¢ƒç®¡ç†ã€é…ç½®é¡¹ç®¡ç†ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ğŸ“‹ å·²å®ŒæˆåŠŸèƒ½

### âœ… æ ¸å¿ƒåŠŸèƒ½æ¨¡å—

#### 1. åº”ç”¨ç®¡ç† (Application Management)
- **åŠŸèƒ½**: åº”ç”¨çš„å¢åˆ æ”¹æŸ¥ã€çŠ¶æ€ç®¡ç†
- **ç‰¹æ€§**: 
  - åº”ç”¨ç¼–ç å”¯ä¸€æ€§æ ¡éªŒ
  - åˆ†é¡µæŸ¥è¯¢å’Œæ¨¡ç³Šæœç´¢
  - åº”ç”¨çŠ¶æ€å¯ç”¨/ç¦ç”¨
  - è´Ÿè´£äººå’Œè”ç³»æ–¹å¼ç®¡ç†

#### 2. ç¯å¢ƒç®¡ç† (Environment Management)
- **åŠŸèƒ½**: ç¯å¢ƒçš„å¢åˆ æ”¹æŸ¥ã€çŠ¶æ€ç®¡ç†
- **ç‰¹æ€§**:
  - ç¯å¢ƒç¼–ç å”¯ä¸€æ€§æ ¡éªŒ
  - ç¯å¢ƒæ’åºåŠŸèƒ½
  - ç¯å¢ƒçŠ¶æ€å¯ç”¨/ç¦ç”¨
  - ç¯å¢ƒæè¿°ç®¡ç†

#### 3. é…ç½®é¡¹ç®¡ç† (Config Item Management)
- **åŠŸèƒ½**: é…ç½®é¡¹çš„å¢åˆ æ”¹æŸ¥ã€çŠ¶æ€ç®¡ç†
- **ç‰¹æ€§**:
  - æ”¯æŒå¤šç§é…ç½®ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”ã€JSONã€YAMLã€Propertiesï¼‰
  - é…ç½®åŠ å¯†æ ‡è®°
  - é…ç½®å¿…å¡«æ ‡è®°
  - æ‰¹é‡æ“ä½œæ”¯æŒ
  - æŒ‰åº”ç”¨å’Œç¯å¢ƒåˆ†ç»„æŸ¥è¯¢
  - é…ç½®é”®å”¯ä¸€æ€§æ ¡éªŒ

#### 4. å®¢æˆ·ç«¯API (Client API)
- **åŠŸèƒ½**: ä¸ºå®¢æˆ·ç«¯æä¾›é…ç½®è·å–æ¥å£
- **ç‰¹æ€§**:
  - è·å–å•ä¸ªé…ç½®é¡¹
  - è·å–åº”ç”¨æ‰€æœ‰é…ç½®
  - é…ç½®é¡¹è¯¦æƒ…æŸ¥è¯¢
  - é…ç½®é¡¹å­˜åœ¨æ€§æ£€æŸ¥
  - é…ç½®é¡¹æ•°é‡ç»Ÿè®¡

### âœ… æŠ€æœ¯æ¶æ„

#### 1. åˆ†å±‚æ¶æ„
- **Controllerå±‚**: RESTful APIæ¥å£
- **Serviceå±‚**: ä¸šåŠ¡é€»è¾‘å¤„ç†
- **Repositoryå±‚**: æ•°æ®è®¿é—®å±‚
- **Entityå±‚**: å®ä½“ç±»å®šä¹‰

#### 2. æŠ€æœ¯æ ˆ
- **Spring Boot 2.7.18**: ä¸»æ¡†æ¶
- **Spring Data JPA**: æ•°æ®è®¿é—®
- **MySQL 8.0**: æ•°æ®åº“
- **Redis**: ç¼“å­˜ï¼ˆå·²é…ç½®ï¼Œå¾…å®ç°ï¼‰
- **Spring Security**: å®‰å…¨æ¡†æ¶ï¼ˆå·²é…ç½®ï¼Œå¾…å®ç°ï¼‰
- **WebSocket**: å®æ—¶æ¨é€ï¼ˆå·²é…ç½®ï¼Œå¾…å®ç°ï¼‰

#### 3. é¡¹ç›®ç»“æ„
```
config-server/
â”œâ”€â”€ src/main/java/com/bank/config/
â”‚   â”œâ”€â”€ ConfigServerApplication.java          # å¯åŠ¨ç±»
â”‚   â”œâ”€â”€ common/                              # é€šç”¨ç±»
â”‚   â”‚   â”œâ”€â”€ ApiResponse.java                 # APIå“åº”ç±»
â”‚   â”‚   â””â”€â”€ GlobalExceptionHandler.java      # å…¨å±€å¼‚å¸¸å¤„ç†å™¨
â”‚   â”œâ”€â”€ config/                              # é…ç½®ç±»
â”‚   â”‚   â”œâ”€â”€ JpaConfig.java                   # JPAé…ç½®
â”‚   â”‚   â””â”€â”€ WebConfig.java                   # Webé…ç½®
â”‚   â”œâ”€â”€ controller/                          # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”œâ”€â”€ ApplicationController.java       # åº”ç”¨ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ EnvironmentController.java       # ç¯å¢ƒç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ConfigItemController.java        # é…ç½®é¡¹ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ConfigClientController.java      # å®¢æˆ·ç«¯API
â”‚   â”‚   â””â”€â”€ HealthController.java            # å¥åº·æ£€æŸ¥
â”‚   â”œâ”€â”€ entity/                              # å®ä½“ç±»
â”‚   â”‚   â”œâ”€â”€ BaseEntity.java                  # åŸºç¡€å®ä½“
â”‚   â”‚   â”œâ”€â”€ Application.java                 # åº”ç”¨å®ä½“
â”‚   â”‚   â”œâ”€â”€ Environment.java                 # ç¯å¢ƒå®ä½“
â”‚   â”‚   â””â”€â”€ ConfigItem.java                  # é…ç½®é¡¹å®ä½“
â”‚   â”œâ”€â”€ repository/                          # æ•°æ®è®¿é—®å±‚
â”‚   â”‚   â”œâ”€â”€ ApplicationRepository.java       # åº”ç”¨Repository
â”‚   â”‚   â”œâ”€â”€ EnvironmentRepository.java       # ç¯å¢ƒRepository
â”‚   â”‚   â””â”€â”€ ConfigItemRepository.java        # é…ç½®é¡¹Repository
â”‚   â””â”€â”€ service/                             # ä¸šåŠ¡é€»è¾‘å±‚
â”‚       â”œâ”€â”€ ApplicationService.java          # åº”ç”¨æœåŠ¡æ¥å£
â”‚       â”œâ”€â”€ EnvironmentService.java          # ç¯å¢ƒæœåŠ¡æ¥å£
â”‚       â”œâ”€â”€ ConfigItemService.java           # é…ç½®é¡¹æœåŠ¡æ¥å£
â”‚       â””â”€â”€ impl/                           # æœåŠ¡å®ç°
â”‚           â”œâ”€â”€ ApplicationServiceImpl.java   # åº”ç”¨æœåŠ¡å®ç°
â”‚           â”œâ”€â”€ EnvironmentServiceImpl.java   # ç¯å¢ƒæœåŠ¡å®ç°
â”‚           â””â”€â”€ ConfigItemServiceImpl.java    # é…ç½®é¡¹æœåŠ¡å®ç°
```

### âœ… APIæ¥å£è®¾è®¡

#### 1. åº”ç”¨ç®¡ç†æ¥å£
- `POST /api/applications` - åˆ›å»ºåº”ç”¨
- `PUT /api/applications/{id}` - æ›´æ–°åº”ç”¨
- `DELETE /api/applications/{id}` - åˆ é™¤åº”ç”¨
- `GET /api/applications/{id}` - è·å–åº”ç”¨è¯¦æƒ…
- `GET /api/applications` - åˆ†é¡µæŸ¥è¯¢åº”ç”¨
- `GET /api/applications/enabled` - è·å–æ‰€æœ‰å¯ç”¨çš„åº”ç”¨
- `PUT /api/applications/{id}/status` - æ›´æ–°åº”ç”¨çŠ¶æ€

#### 2. ç¯å¢ƒç®¡ç†æ¥å£
- `POST /api/environments` - åˆ›å»ºç¯å¢ƒ
- `PUT /api/environments/{id}` - æ›´æ–°ç¯å¢ƒ
- `DELETE /api/environments/{id}` - åˆ é™¤ç¯å¢ƒ
- `GET /api/environments/{id}` - è·å–ç¯å¢ƒè¯¦æƒ…
- `GET /api/environments` - åˆ†é¡µæŸ¥è¯¢ç¯å¢ƒ
- `GET /api/environments/enabled` - è·å–æ‰€æœ‰å¯ç”¨çš„ç¯å¢ƒ
- `PUT /api/environments/{id}/status` - æ›´æ–°ç¯å¢ƒçŠ¶æ€

#### 3. é…ç½®é¡¹ç®¡ç†æ¥å£
- `POST /api/config-items` - åˆ›å»ºé…ç½®é¡¹
- `PUT /api/config-items/{id}` - æ›´æ–°é…ç½®é¡¹
- `DELETE /api/config-items/{id}` - åˆ é™¤é…ç½®é¡¹
- `GET /api/config-items/{id}` - è·å–é…ç½®é¡¹è¯¦æƒ…
- `GET /api/config-items` - åˆ†é¡µæŸ¥è¯¢é…ç½®é¡¹
- `POST /api/config-items/batch` - æ‰¹é‡åˆ›å»ºé…ç½®é¡¹
- `PUT /api/config-items/batch` - æ‰¹é‡æ›´æ–°é…ç½®é¡¹

#### 4. å®¢æˆ·ç«¯APIæ¥å£
- `GET /api/client/config/{appCode}/{envCode}/{configKey}` - è·å–å•ä¸ªé…ç½®é¡¹
- `GET /api/client/configs/{appCode}/{envCode}` - è·å–åº”ç”¨æ‰€æœ‰é…ç½®
- `GET /api/client/config-detail/{appCode}/{envCode}/{configKey}` - è·å–é…ç½®é¡¹è¯¦æƒ…
- `GET /api/client/config-exists/{appCode}/{envCode}/{configKey}` - æ£€æŸ¥é…ç½®é¡¹æ˜¯å¦å­˜åœ¨
- `GET /api/client/config-count/{appCode}/{envCode}` - è·å–é…ç½®é¡¹æ•°é‡

### âœ… æ•°æ®åº“è®¾è®¡

åŸºäºæä¾›çš„æ•°æ®åº“è®¾è®¡è„šæœ¬ï¼Œå®ç°äº†ä»¥ä¸‹æ ¸å¿ƒè¡¨ï¼š

1. **applications** - åº”ç”¨è¡¨
2. **environments** - ç¯å¢ƒè¡¨
3. **config_items** - é…ç½®é¡¹è¡¨
4. **config_groups** - é…ç½®ç»„è¡¨ï¼ˆå¾…å®ç°ï¼‰
5. **config_versions** - é…ç½®ç‰ˆæœ¬è¡¨ï¼ˆå¾…å®ç°ï¼‰
6. **push_tasks** - æ¨é€ä»»åŠ¡è¡¨ï¼ˆå¾…å®ç°ï¼‰
7. **client_connections** - å®¢æˆ·ç«¯è¿æ¥è¡¨ï¼ˆå¾…å®ç°ï¼‰

### âœ… å¼‚å¸¸å¤„ç†

å®ç°äº†å…¨å±€å¼‚å¸¸å¤„ç†å™¨ï¼ŒåŒ…æ‹¬ï¼š
- å‚æ•°æ ¡éªŒå¼‚å¸¸å¤„ç†
- ç»‘å®šå¼‚å¸¸å¤„ç†
- çº¦æŸè¿åå¼‚å¸¸å¤„ç†
- è¿è¡Œæ—¶å¼‚å¸¸å¤„ç†
- é€šç”¨å¼‚å¸¸å¤„ç†

### âœ… é…ç½®ç®¡ç†

- **application.yml**: åº”ç”¨é…ç½®æ–‡ä»¶
- **JpaConfig**: JPAé…ç½®ç±»
- **WebConfig**: Webé…ç½®ç±»
- **CORS**: è·¨åŸŸé…ç½®

## ğŸš€ å¿«é€Ÿå¯åŠ¨

### 1. ç¯å¢ƒè¦æ±‚
- JDK 8+
- Maven 3.6+
- MySQL 8.0+
- Redis 6.0+ï¼ˆå¯é€‰ï¼‰

### 2. æ•°æ®åº“å‡†å¤‡
```sql
CREATE DATABASE config_center CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

### 3. å¯åŠ¨åº”ç”¨
```bash
# Windows
start.bat

# Linux/Mac
./start.sh

# æˆ–è€…ç›´æ¥ä½¿ç”¨Maven
mvn spring-boot:run
```

### 4. éªŒè¯å¯åŠ¨
è®¿é—® `http://localhost:8080/api/health` æŸ¥çœ‹æœåŠ¡çŠ¶æ€ã€‚

## ğŸ“Š æµ‹è¯•éªŒè¯

### 1. å¥åº·æ£€æŸ¥
```bash
curl http://localhost:8080/api/health
```

### 2. åˆ›å»ºæµ‹è¯•æ•°æ®
```bash
# åˆ›å»ºåº”ç”¨
curl -X POST http://localhost:8080/api/applications \
  -H "Content-Type: application/json" \
  -d '{
    "appCode": "test-app",
    "appName": "æµ‹è¯•åº”ç”¨",
    "appDesc": "ç”¨äºæµ‹è¯•çš„åº”ç”¨ç¨‹åº",
    "owner": "æµ‹è¯•ç”¨æˆ·",
    "contactEmail": "test@example.com"
  }'

# åˆ›å»ºç¯å¢ƒ
curl -X POST http://localhost:8080/api/environments \
  -H "Content-Type: application/json" \
  -d '{
    "envCode": "test",
    "envName": "æµ‹è¯•ç¯å¢ƒ",
    "envDesc": "ç”¨äºæµ‹è¯•çš„ç¯å¢ƒ",
    "sortOrder": 1
  }'

# åˆ›å»ºé…ç½®é¡¹
curl -X POST http://localhost:8080/api/config-items \
  -H "Content-Type: application/json" \
  -d '{
    "appId": 1,
    "envId": 1,
    "configKey": "test.key",
    "configValue": "test-value",
    "configType": 1,
    "description": "æµ‹è¯•é…ç½®é¡¹"
  }'
```

## ğŸ”„ å¾…å¼€å‘åŠŸèƒ½

### 1. å®‰å…¨è®¤è¯
- [ ] Spring Securityé›†æˆ
- [ ] JWTä»¤ç‰Œè®¤è¯
- [ ] ç”¨æˆ·æƒé™ç®¡ç†
- [ ] APIå¯†é’¥è®¤è¯

### 2. ç‰ˆæœ¬æ§åˆ¶
- [ ] é…ç½®ç‰ˆæœ¬ç®¡ç†
- [ ] ç‰ˆæœ¬å¯¹æ¯”åŠŸèƒ½
- [ ] ç‰ˆæœ¬å›æ»šåŠŸèƒ½
- [ ] ç‰ˆæœ¬æ ‡ç­¾ç®¡ç†

### 3. å®æ—¶æ¨é€
- [ ] WebSocketè¿æ¥ç®¡ç†
- [ ] é…ç½®å˜æ›´æ¨é€
- [ ] æ¨é€çŠ¶æ€è·Ÿè¸ª
- [ ] æ¨é€å¤±è´¥é‡è¯•

### 4. é«˜çº§åŠŸèƒ½
- [ ] é…ç½®åŠ å¯†åŠŸèƒ½
- [ ] é…ç½®æ¨¡æ¿åŠŸèƒ½
- [ ] ç°åº¦å‘å¸ƒåŠŸèƒ½
- [ ] é…ç½®éªŒè¯åŠŸèƒ½

### 5. ç›‘æ§å’Œæ—¥å¿—
- [ ] æ“ä½œæ—¥å¿—è®°å½•
- [ ] è®¿é—®æ—¥å¿—ç»Ÿè®¡
- [ ] æ€§èƒ½ç›‘æ§
- [ ] å‘Šè­¦æœºåˆ¶

### 6. ç¼“å­˜ä¼˜åŒ–
- [ ] Redisç¼“å­˜é›†æˆ
- [ ] é…ç½®ç¼“å­˜ç­–ç•¥
- [ ] ç¼“å­˜å¤±æ•ˆæœºåˆ¶
- [ ] ç¼“å­˜é¢„çƒ­

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### ç›®æ ‡æ€§èƒ½
- **é…ç½®è¯»å–å“åº”**: P95 < 100ms
- **å¹¶å‘å®¢æˆ·ç«¯**: â‰¥ 100
- **æ¨é€å»¶è¿Ÿ**: < 1ç§’
- **ç³»ç»Ÿå¯ç”¨æ€§**: â‰¥ 99.9%

### å½“å‰çŠ¶æ€
- âœ… åŸºç¡€CRUDæ“ä½œå®Œæˆ
- âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸
- âœ… APIæ¥å£å“åº”æ­£å¸¸
- â³ æ€§èƒ½ä¼˜åŒ–å¾…è¿›è¡Œ
- â³ å‹åŠ›æµ‹è¯•å¾…è¿›è¡Œ

## ğŸ‰ æ€»ç»“

æœ¬é¡¹ç›®å·²ç»å®Œæˆäº†é…ç½®ä¸­å¿ƒæœåŠ¡ç«¯çš„åŸºç¡€åŠŸèƒ½å¼€å‘ï¼ŒåŒ…æ‹¬ï¼š

1. **å®Œæ•´çš„CRUDæ“ä½œ**: åº”ç”¨ã€ç¯å¢ƒã€é…ç½®é¡¹çš„ç®¡ç†
2. **RESTful APIè®¾è®¡**: æ ‡å‡†çš„RESTæ¥å£
3. **å¼‚å¸¸å¤„ç†æœºåˆ¶**: å…¨å±€å¼‚å¸¸å¤„ç†å™¨
4. **æ•°æ®åº“é›†æˆ**: JPA + MySQL
5. **é¡¹ç›®æ–‡æ¡£**: è¯¦ç»†çš„READMEå’ŒAPIæ–‡æ¡£
6. **æµ‹è¯•è„šæœ¬**: è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

é¡¹ç›®æ¶æ„æ¸…æ™°ï¼Œä»£ç ç»“æ„è§„èŒƒï¼Œä¸ºåç»­åŠŸèƒ½æ‰©å±•å¥ å®šäº†è‰¯å¥½çš„åŸºç¡€ã€‚ä¸‹ä¸€æ­¥å¯ä»¥ç»§ç»­å¼€å‘å®‰å…¨è®¤è¯ã€ç‰ˆæœ¬æ§åˆ¶ã€å®æ—¶æ¨é€ç­‰é«˜çº§åŠŸèƒ½ã€‚ 